{% extends 'enigmes/base.html' %}

{% block nav %}
{% include 'enigmes/nav.html' with nav="nav_complete" page="espace_perso" %}
{% endblock %}

{% block content %}
{% load static %}
<div class="espace-perso-container">
    <h1>Espace personnel de {{ auteur.first_name }} {{ auteur.last_name }}</h1>

    <div class="zone-container">
        <span class="titre-zone">Mes énigmes</span>
        <div class="zone-creation">
            <div class="creation-enigme">
                <a class="lien-div" href="{% url 'enigme-create' %}"></a>
                <div class="creation-contenu">
                    <svg class="icone" id="add-plus" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 122.88"><title>add</title><path d="M61.44,0A61.46,61.46,0,1,1,18,18,61.25,61.25,0,0,1,61.44,0ZM88.6,56.82v9.24a4,4,0,0,1-4,4H70V84.62a4,4,0,0,1-4,4H56.82a4,4,0,0,1-4-4V70H38.26a4,4,0,0,1-4-4V56.82a4,4,0,0,1,4-4H52.84V38.26a4,4,0,0,1,4-4h9.24a4,4,0,0,1,4,4V52.84H84.62a4,4,0,0,1,4,4Zm8.83-31.37a50.92,50.92,0,1,0,14.9,36,50.78,50.78,0,0,0-14.9-36Z"/></svg>
                    <div class="zone-contenu">
                        <h2 class="titre">Ajouter une énigme</h2>
                        <p>Cliquez ici pour accéder au formulaire de création d'une énigme.</p>
                    </div>
                </div>
            </div>
            <div class="creation-enigme">
                <a class="lien-div" href="{% url 'mes-enigmes' %}"></a>
                <div class="creation-contenu">
                    <svg class="icone" id="eye" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 83.78" style="enable-background:new 0 0 122.88 83.78" xml:space="preserve"><g><path d="M95.73,10.81c10.53,7.09,19.6,17.37,26.48,29.86l0.67,1.22l-0.67,1.21c-6.88,12.49-15.96,22.77-26.48,29.86 C85.46,79.88,73.8,83.78,61.44,83.78c-12.36,0-24.02-3.9-34.28-10.81C16.62,65.87,7.55,55.59,0.67,43.1L0,41.89l0.67-1.22 c6.88-12.49,15.95-22.77,26.48-29.86C37.42,3.9,49.08,0,61.44,0C73.8,0,85.45,3.9,95.73,10.81L95.73,10.81z M60.79,22.17l4.08,0.39 c-1.45,2.18-2.31,4.82-2.31,7.67c0,7.48,5.86,13.54,13.1,13.54c2.32,0,4.5-0.62,6.39-1.72c0.03,0.47,0.05,0.94,0.05,1.42 c0,11.77-9.54,21.31-21.31,21.31c-11.77,0-21.31-9.54-21.31-21.31C39.48,31.71,49.02,22.17,60.79,22.17L60.79,22.17L60.79,22.17z M109,41.89c-5.5-9.66-12.61-17.6-20.79-23.11c-8.05-5.42-17.15-8.48-26.77-8.48c-9.61,0-18.71,3.06-26.76,8.48 c-8.18,5.51-15.29,13.45-20.8,23.11c5.5,9.66,12.62,17.6,20.8,23.1c8.05,5.42,17.15,8.48,26.76,8.48c9.62,0,18.71-3.06,26.77-8.48 C96.39,59.49,103.5,51.55,109,41.89L109,41.89z"/></g></svg>                <!-- <img src="{% static 'enigmes/img/eye.svg' %}" alt="logo création" width="50"> -->        
                    <div class="zone-contenu">
                        <h2 class="titre">Mes énigmes</h2>
                        <p>Cliquez ici pour voir vos énigmes.</p>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <div class="zone-container">
        <span class="titre-zone">Mes enquêtes</span>
        <p>Pour créer une enquête, il suffit de sélectionner une ou plusieurs énigmes qui formeront l'enquête. Pour cela, il existe deux possibilités : <strong>par sélection manuelle</strong> en parcourant toutes les énigmes, ou <strong>par numéros d'énigmes</strong> en indiquant directement les numéros des énigmes. <br>Plus d'informations en <a href="#infos-enquetes">bas de page</a> sur les enquêtes et leur création.</p>
        <div class="zone-creation">
            <div class="creation-enquete">
                <a class="lien-div" href="{% url 'enquete-manuelle-create' %}"></a>
                <div class="creation-contenu">
                    <svg class="icone" id="check-mark-box" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.879 109.721" enable-background="new 0 0 122.879 109.721" xml:space="preserve"><g><path d="M31.989,55.49c-4.336-3.752-4.808-10.31-1.057-14.646c3.753-4.335,10.311-4.81,14.646-1.057l16.2,14.045l43.211-45.69 c3.933-4.156,10.49-4.338,14.647-0.408c4.156,3.932,4.34,10.49,0.408,14.646l-49.55,52.394l-0.173,0.197 c-3.751,4.336-10.309,4.809-14.644,1.059L31.989,55.49L31.989,55.49z M18.819,0h72.087h0.005v0.036h0.029L73.203,18.284H18.819 h-0.014V18.25c-0.104,0-0.234,0.075-0.354,0.195l-0.018-0.018l-0.018,0.018c-0.102,0.102-0.166,0.233-0.166,0.367h0.036v0.005 v72.087v0.012H18.25c0,0.104,0.077,0.234,0.197,0.355l-0.018,0.018l0.018,0.016c0.102,0.104,0.233,0.166,0.365,0.166v-0.033h0.007 h72.087h0.012v0.033c0.129,0,0.27-0.074,0.39-0.195c0.103-0.102,0.166-0.232,0.166-0.367h-0.034v-0.004V73.059l18.284-18.813 v36.658v0.004h-0.037c-0.002,5.184-2.117,9.893-5.521,13.293c-3.379,3.379-8.068,5.479-13.247,5.484v0.035h-0.012H18.819h-0.007 v-0.035c-5.175-0.004-9.874-2.111-13.275-5.506l-0.018,0.018c-3.379-3.379-5.477-8.08-5.483-13.281H0v-0.012V18.817v-0.005h0.036 c0.002-5.177,2.111-9.873,5.506-13.274L5.524,5.52c3.378-3.381,8.077-5.479,13.282-5.483V0H18.819L18.819,0z"/></g></svg>
                    <div class="zone-contenu">
                        <h2 class="titre">Créer une enquête par sélection manuelle</h2>
                    </div>
                </div>
            </div>
            <div class="creation-enquete">
                <a class="lien-div" href="{% url 'enquete-liste-create' %}"></a>
                <div class="creation-contenu">
                    <svg class="icone" id="numbers-block" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 113.29" style="enable-background:new 0 0 122.88 113.29" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M72.17,60.87l38-6.11c3.37-0.54,6.58,1.78,7.12,5.15l5.51,34.24c0.54,3.37-1.78,6.58-5.15,7.12l-38,6.11 c-3.37,0.54-6.58-1.78-7.12-5.15l-5.51-34.24C66.48,64.62,68.8,61.41,72.17,60.87L72.17,60.87z M91.64,76.94l-7.35-0.08 c0.22-2.37,1.06-4.3,2.55-5.8c1.48-1.49,3.77-2.5,6.85-3.01c3.55-0.59,6.21-0.36,8.02,0.7c1.8,1.06,2.87,2.59,3.2,4.59 c0.2,1.17,0.05,2.29-0.43,3.35s-1.3,2.05-2.48,2.98c1.09,0.08,1.95,0.25,2.56,0.51c1,0.41,1.82,1.02,2.47,1.85 c0.65,0.83,1.09,1.87,1.3,3.13c0.26,1.58,0.11,3.17-0.48,4.77c-0.59,1.59-1.59,2.91-3.02,3.95c-1.43,1.04-3.41,1.78-5.95,2.2 c-2.47,0.41-4.47,0.45-5.99,0.1c-1.53-0.34-2.84-1-3.95-1.96c-1.1-0.97-2.05-2.26-2.83-3.88l7.39-2.27 c0.55,1.48,1.19,2.46,1.91,2.95c0.72,0.49,1.56,0.65,2.53,0.49c1.01-0.17,1.79-0.68,2.34-1.54c0.55-0.85,0.72-1.9,0.51-3.14 c-0.21-1.26-0.7-2.18-1.46-2.77c-0.76-0.58-1.7-0.78-2.81-0.6c-0.59,0.1-1.38,0.38-2.36,0.85l-0.51-5.47 c0.42-0.01,0.75-0.03,0.98-0.07c0.98-0.16,1.74-0.62,2.29-1.35c0.55-0.74,0.75-1.53,0.61-2.39c-0.14-0.83-0.5-1.45-1.06-1.85 c-0.58-0.41-1.29-0.55-2.15-0.4c-0.89,0.15-1.56,0.53-2.03,1.16C91.83,74.57,91.61,75.57,91.64,76.94L91.64,76.94z M62.77,11.41 l4.62,27.72l-7.65,1.28l-3.02-18.13c-1.08,1.15-2.15,2.1-3.22,2.87c-1.06,0.77-2.43,1.57-4.08,2.39l-1.03-6.17 c2.44-1.27,4.27-2.6,5.5-4.01c1.23-1.41,2.11-3.04,2.63-4.9L62.77,11.41L62.77,11.41z M17.77,56.97l36.92,10.88 c3.28,0.97,5.17,4.44,4.2,7.72l-9.8,33.26c-0.97,3.28-4.44,5.17-7.72,4.2L4.46,102.16c-3.28-0.97-5.17-4.44-4.2-7.72l9.8-33.26 C11.02,57.9,14.49,56.01,17.77,56.97L17.77,56.97z M44.48,86l-5.06-0.72c-0.28,0.32-0.59,0.63-0.93,0.92 c-1.28,1.1-3.32,2.13-6.12,3.08c-1.66,0.54-2.77,0.94-3.35,1.18c-0.58,0.25-1.27,0.58-2.08,1.01l10.68,3.16l-1.65,5.56l-20.51-6.06 c0.83-1.95,2.11-3.65,3.83-5.07c1.72-1.43,4.57-2.88,8.57-4.34c0.76-0.28,1.43-0.54,2.03-0.79l0,0c1.34-0.56,2.28-1.04,2.83-1.46 c0.79-0.61,1.29-1.26,1.49-1.95c0.22-0.75,0.14-1.47-0.26-2.17c-0.4-0.7-1.02-1.17-1.86-1.42c-0.87-0.26-1.67-0.19-2.38,0.19 c-0.72,0.39-1.38,1.25-1.98,2.59l-6.67-2.58c0.84-1.85,1.78-3.2,2.81-4.07c1.04-0.87,2.29-1.4,3.76-1.59 c1.48-0.19,3.36,0.05,5.67,0.74c2.4,0.71,4.19,1.54,5.37,2.48c1.17,0.94,1.98,2.09,2.4,3.45c0.43,1.37,0.44,2.75,0.02,4.16 c-0.33,1.1-0.88,2.09-1.66,2.99L44.48,86L44.48,86z M36.49,6.19l38-6.11c3.37-0.54,6.58,1.78,7.12,5.15l5.51,34.24 c0.54,3.37-1.78,6.58-5.15,7.12l-38,6.11c-3.37,0.54-6.58-1.78-7.12-5.15l-5.51-34.24C30.8,9.94,33.12,6.73,36.49,6.19L36.49,6.19z"/></g></svg>
                    <div class="zone-contenu">
                        <h2 class="titre">Créer une enquête par numéros d'énigmes</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
       
    <div class="detail-enquetes">
        <h2>Tableau de bord de vos enquêtes</h2>
        <p>Vous pouvez accéder au détail d'une enquête en cliquant sur sa description. Vous pourrez notamment y trouver les paramètres de l'enquête (et les modifier si besoin), la liste des énigmes composant l'enquête, un lien pour voir le détail des résultats, un autre pour exporter les résultats dans un fichier CSV, etc.</p>
        {% if enquetes_perso.count == 0 %}
        <p><em>Aucune enquête pour le moment</em></p>
        {% else %}
        <table id="tableau-de-bord">
            <thead class="intitule-colonnes">
                <tr>
                    <th>Date de création</th>
                    <th>Description</th>
                    <th>Clé de l'enquête</th>
                    <th>Actif</th>
                    <th>Action</th>
                    <th>Code enquête</th>
                    <th>Lien enquête</th>
                    <th>Résultats</th>
                    <th>Suppression</th>
                </tr>
            </thead>
            <tbody>
            {% for enquete in enquetes_perso %}
                <tr>
                    <td>{{ enquete.date_creation }}</td>
                    {% if enquete.description != '' %}
                        <td>
                            <a href="{% url 'enquete-detail' enquete_id=enquete.pk %}">{{ enquete.description }}</a>
                        </td>
                    {% else %}
                        <td>
                            <a href="{% url 'enquete-detail' enquete_id=enquete.pk %}">enquete {{ enquete.pk }}</a>
                        </td>
                    {% endif %}            
                    {% if enquete.cle %}
                        <td>{{ enquete.cle }}</td>
                    {% else %}
                        <td>*</td>
                    {% endif %}
                    {% if enquete.active %}
                        <td class="enquete-active"><span>Oui</span></td>
                    {% else %}
                        <td>Non</td>
                    {% endif %}
                    <td>
                        {% if enquete.active %}
                        <form class="btn-actions" action="" method="POST">
                            {% csrf_token %}
                            <button class="btn-desactiver" type="submit" value="{{enquete.pk}}" name="desactiver">Désactiver</button>
                        </form>
                        {% else %}
                        <form class="btn-actions" action="" method="POST">
                            {% csrf_token %}
                            <button class="btn-activer" type="submit" value="{{enquete.pk}}" name="activer">Activer</button>
                        </form>
                        {% endif %}
                    </td>
                    {% if enquete.code %}
                        <td>{{ enquete.code }}</td>
                    {% else %}
                        <td>*</td>
                    {% endif %}
                    <td class="lien-enquete">
                        <span class="lien-url-enquete" data-lien="{%url 'enquete-eleve' code_enquete=enquete.code %}">
                            Copier
                            <img src="{% static 'enigmes/img/copy-link.svg' %}" alt="icone copier" width="20px">
                        </span>
                    </td>
                    <td class="lien-resultats">
                        <a href="{% url 'enquete-resultats' enquete_id=enquete.pk  %}">
                            <img class="centre img-lien" src="{% static 'enigmes/img/results.svg' %}" alt="lien" width="25px">
                        </a>
                    </td>
                    <td>
                        <form class="btn-suppression" action="" method="POST">
                            {% csrf_token %}
                            <button class="btn-corbeille" type="submit" value="{{enquete.pk}}" name="supprimer">
                                {% load static %}
                                <img class="centre img-corbeille" src="{% static 'enigmes/img/corbeille-ligne.svg' %}" alt="corbeille" width="20px">
                            </button>
                        </form>
                    </td>
                </tr>        
            {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
    
    <div class="modal-lien" id="modale-lien">
        <div class="modal-lien-content">
            <p class="texte-modale"></p>
        </div>
    </div>
    
    <div id="infos-enquetes">
        <div id="zone-titre-infos-enquetes">
            <svg class="icone" id="info" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 122.88"><title>more-info</title><path d="M61.44,0A61.46,61.46,0,1,1,18,18,61.25,61.25,0,0,1,61.44,0ZM59.12,36a8,8,0,0,1,.61-3.16,7.82,7.82,0,0,1,1.8-2.63,8.33,8.33,0,0,1,2.62-1.79,8.08,8.08,0,0,1,6.11,0,8.06,8.06,0,0,1,2.58,1.79,7.83,7.83,0,0,1,1.77,2.63A8.38,8.38,0,0,1,75.2,36a8.15,8.15,0,0,1-.59,3.1,8.23,8.23,0,0,1-1.76,2.65,8.15,8.15,0,0,1-2.59,1.82,7.72,7.72,0,0,1-3.05.6,8,8,0,0,1-3.12-.6,7.84,7.84,0,0,1-2.61-1.8,8.07,8.07,0,0,1-1.77-2.64A8.3,8.3,0,0,1,59.12,36Zm3.09,47.8-.17.63-.12.49-.05.34,0,.27a2,2,0,0,0,.09.64v0a1.09,1.09,0,0,0,.23.41.86.86,0,0,0,.35.23,1.55,1.55,0,0,0,.55.09,2.74,2.74,0,0,0,1.46-.63,14.6,14.6,0,0,0,2.15-2.06,36,36,0,0,0,2.57-3.3c.89-1.26,1.82-2.71,2.79-4.33a.37.37,0,0,1,.5-.13l3.28,2.44a.36.36,0,0,1,.09.5,56.84,56.84,0,0,1-4.58,6.87,30.35,30.35,0,0,1-4.73,4.89l0,0a18.55,18.55,0,0,1-4.92,2.92,14.15,14.15,0,0,1-5.19,1,13.63,13.63,0,0,1-4.07-.55,7.92,7.92,0,0,1-3-1.66,7.1,7.1,0,0,1-1.86-2.72,9.92,9.92,0,0,1-.61-3.62c0-.45,0-.92.08-1.42s.14-1,.25-1.58v0c.1-.54.25-1.15.43-1.82s.41-1.43.67-2.26L54.1,61.61l.47-1.67c.12-.47.22-.88.3-1.24a8.43,8.43,0,0,0,.15-.9,5.75,5.75,0,0,0,.06-.77,2.9,2.9,0,0,0-.2-1.09v0a2.49,2.49,0,0,0-.57-.81,2.68,2.68,0,0,0-.94-.55,4.15,4.15,0,0,0-1.28-.19H47.45a.37.37,0,0,1-.37-.36l0-.13,1.22-4.43a.37.37,0,0,1,.36-.27l23.67-.75a.38.38,0,0,1,.38.36l0,.12L62.21,83.78ZM97,25.88a50.31,50.31,0,1,0,14.72,35.56A50.16,50.16,0,0,0,97,25.88Z"/></svg>
            <h3 id="titre-infos-enquetes">Quelques informations sur les enquêtes</h3>
        </div>
    
        <p>Une enquête créée est par défaut <em>active</em>, c'est-à-dire qu'elle est disponible pour les élèves. Vous pouvez <em>désactiver</em> une enquête, elle ne sera alors plus accessible pour les élèves</p>
    
        <p>Au moment de la création d'une enquête, vous devrez :</p>
        <ul>
            <li>renseigner <strong>une description de l'enquête</strong> (à destination uniquement de l'enseignant). Cette description peut contenir le nom de la classe ou du groupe concerné, le(s) thème(s) de l'enquête, etc. Cette description permettra de mieux vous y retrouver.</li>
            <li>choisir si les élèves auront accès aux <strong>indications</strong> (si celles-ci existent pour les énigmes choisies)</li>
            <li>choisir si une <strong>correction</strong> est proposée aux élèves à la fin de leur enquête</li>
            <li>choisir si le <strong>score</strong> de l'élève lui est communiqué à la fin de son enquête (en cas de correction activée, le score est automatiquement affiché)</li>
            <li>choisir si les énigmes de l'enquête sont proposées dans un <strong>ordre aléatoire</strong> aux élèves</li>
        </ul>
        
        <p>Ces quatre derniers choix pourront être modifiés après la création de l'enquête, mais il faudra d'abord <em>désactiver</em> l'enquête, puis la réactiver pour qu'elle soit à nouveau accessible aux élèves.</p>
        
        <p>Les enquêtes ne sont pas partagées avec les autres utilisateurs.</p>
        
        <p>Pour chaque enquête, un <strong>code unique</strong> à 8 caractères sera généré. C'est ce code qu'il faut communiquer à vos élèves et qu'ils doivent saisir sur la <a href="/">page d'accueil</a> de l'application pour démarrer l'enquête. Vous pourrez aussi leur communiquer une URL directe vers l'enquête.</p>
        
        <p>Pour différencier vos différents élèves, un <strong>identifiant</strong> leur sera demandé.</p> 
        <strong>
            <p><span style="font-size: 1.4em;">⚠️</span> C'est à vous de définir les identifiants de vos élèves. Un identifiant ne peut pas être vide et doit nécessairement être de la forme :</p>
            <ul>
                <li>une suite de caractères parmi les chiffres de 0 à 9 ainsi que les caractères "-" (tiret) et "_" (underscore). </li>
                <li>éventuellement <em>précédée</em> d'une seule et unique lettre (optionnel, mais permet éventuellement de différencier les classes)</li>
            </ul>
        </strong>
        
        <p>Par exemple, les identifiants <em>2569845</em>, <em>B25</em> et <em>E-12_01</em> sont valides, mais <em>12/30</em> (caractère "/" non valide), <em>17B</em> (lettre pas en première position) et <em>A_25J</em> (un deuxième lettre interdite) ne le sont pas.</p>
                
        <p>Ces identifiants sont ainsi vierges de données personnelles sur les élèves. Ils seront stockés dans la base de donnnées et permettront d'associer un résultat à chaque élève pour chaque enquête.</strong></p>
    
        <p>Le tableau de bord de cette page recense les différentes enquêtes que vous avez créées. Vous pouvez accéder au détail de chacune d'elle en cliquant sur le lien de sa description.</p>
    
        <p>Vous pouvez accéder aux résultats et réponses de vos élèves en cliquant sur le lien correspondant dans le tableau de bord ou dans les détails de l'enquête. Il est possible d'exporter ces résultats dans un fichier CSV.</p>
        
        <p>Vous pouvez également supprimer une enquête via le tableau de bord ou la page de détails de l'enquête, mais toutes les données de l'enquête seront perdues. Assurez-vous donc d'avoir récupéré les résultats avant la suppression</p>
    </div>
</div>

{% endblock %}

{% block jsfiles %}
{% load static %}
<script src="{% static 'enigmes/js/gestion_modale_copie_csv.js' %}"></script>
{% endblock %}